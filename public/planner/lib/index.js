!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("planner_v3",[],n):"object"==typeof exports?exports.planner_v3=n():e.planner_v3=n()}(self,(()=>(()=>{"use strict";return{607:function(){var e=this&&this.__awaiter||function(e,n,o,t){return new(o||(o=Promise))((function(r,a){function i(e){try{c(t.next(e))}catch(e){a(e)}}function l(e){try{c(t.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,l)}c((t=t.apply(e,n||[])).next())}))},n=this&&this.__generator||function(e,n){var o,t,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(c){return function(l){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(i=0)),i;)try{if(o=1,t&&(r=2&l[0]?t.return:l[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,l[1])).done)return r;switch(t=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,t=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=n.call(e,i)}catch(e){l=[6,e],t=0}finally{o=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}};e(void 0,void 0,void 0,(function(){function o(e){try{var n=JSON.parse(e);window.planner.login(n),n.is_patreon&&window.removeAds()}catch(e){console.error(e,"Failed to parse user object")}}var t,r,a,i,l,c,u;return n(this,(function(s){switch(s.label){case 0:t={AUTH:"/api/auth",USER:"/api/me"},window.hideModal=function(e){var n;localStorage.setItem("modalSeen_".concat(e,"_v1"),"true"),null===(n=document.querySelector("#".concat(e)))||void 0===n||n.classList.add("hidden")},window.showModal=function(e){var n;localStorage.setItem("modalSeen_".concat(e,"_v1"),"true");var o="#".concat(e);console.log("showing modal",o),null===(n=document.querySelector(o))||void 0===n||n.classList.remove("hidden")},window.isModalOpen=function(e){var n;return!(null===(n=document.querySelector("#".concat(e)))||void 0===n?void 0:n.classList.contains("hidden"))},window.showModalOnce=function(e){localStorage.getItem("modalSeen_".concat(e,"_v1"))||window.showModal(e)},window.loginWithProvider=function(o){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return window.localStorage.setItem("user","fetch"),[4,window.planner.savePlan()];case 1:return e.sent(),window.location.href="".concat(t.AUTH,"/").concat(o,"?redirect=").concat(window.location.pathname),[2]}}))}))},window.logout=function(){var o;return e(this,void 0,void 0,(function(){return n(this,(function(e){return null===(o=window.localStorage)||void 0===o||o.removeItem("user"),window.planner.logout(),[2]}))}))},window.removeAds=function(){var e;null===(e=document.querySelector("body"))||void 0===e||e.classList.add("supporter")},d=function(){return e(void 0,void 0,void 0,(function(){var e,r,a;return n(this,(function(n){switch(n.label){case 0:return console.log("running page ready"),"fetch"!==(e=null===(a=window.localStorage)||void 0===a?void 0:a.getItem("user"))?[3,3]:(console.log("LocalStorage user marked as fetch, doing user/me request"),window.localStorage.removeItem("user"),[4,fetch("".concat(t.USER))]);case 1:return[4,n.sent().json()];case 2:return+n.sent().id>0&&(r=JSON.stringify(e),window.localStorage.setItem("user",r),o(r)),[3,4];case 3:e&&"fetch"!==e&&(console.log("User found and logged in, setting user",e),o(e)),n.label=4;case 4:return[2]}}))}))},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),s.label=1;case 1:return s.trys.push([1,5,,6]),"fetch"!==(null===(l=window.localStorage)||void 0===l?void 0:l.getItem("user"))?[3,4]:(console.log("LocalStorage user marked as fetch, doing user/me request"),window.localStorage.removeItem("user"),[4,fetch("".concat(t.USER))]);case 2:return[4,s.sent().json()];case 3:+(r=s.sent()).id>0&&(a=JSON.stringify(r),window.localStorage.setItem("user",a),o(a)),s.label=4;case 4:return[3,6];case 5:return i=s.sent(),console.error("User handling failed",i),[3,6];case 6:return document.querySelectorAll("[data-login-provider]").forEach((function(o){o.addEventListener("click",(function(){return e(void 0,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return(e=o.dataset.loginProvider)?[4,window.loginWithProvider(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}))})),document.querySelectorAll("[data-modal-toggle]").forEach((function(e){e.addEventListener("click",(function(){var n=e.dataset.modalToggle,o=document.querySelector("#".concat(n));o&&(o.style.display&&"none"!==o.style.display?o.style.display="none":o.style.display="block")}))})),null===(c=document.querySelector("#fileinput"))||void 0===c||c.addEventListener("change",(function(o){return e(void 0,void 0,void 0,(function(){var e,o,t;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),(e=new FormData).append("file",document.querySelector("#fileinput").files[0]),[4,fetch("/api/import",{method:"POST",body:e})];case 1:return[4,n.sent().json()];case 2:return o=n.sent(),console.log("Save game uploaded to API",o.id),window.location.href="/planner/"+o.id,[3,4];case 3:return t=n.sent(),console.error("Failed to upload save game",t),window.planner.hideLoader(),[3,4];case 4:return[2]}}))}))})),null===(u=document.querySelector("#fileinput-layout"))||void 0===u||u.addEventListener("change",(function(o){return e(void 0,void 0,void 0,(function(){var e,o,t;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),(e=new FormData).append("file",document.querySelector("#fileinput-layout").files[0]),[4,fetch("/api/custom-layout",{method:"POST",body:e})];case 1:return[4,n.sent().json()];case 2:return o=n.sent(),console.log("Custom layout uploaded to API",o.id),window.location.href="/planner/"+o.id,[3,4];case 3:return t=n.sent(),console.error("Failed to upload custom layout",t),window.planner.hideLoader(),[3,4];case 4:return[2]}}))}))})),localStorage.getItem("modalSeen_mainModal_v1")||window.showModal("mainModal"),[2]}var d}))}))}}[607](),{}})()));